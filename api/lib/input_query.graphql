# =================================================================
# get a list of all labels in a repository
# =================================================================
#         input: $loginOrg: e.g. IQSS/dataverse
#              : repository: e.g. dataverse
#              : $firstFew: get this many items on this query
#              : $startWith: the starting place for getting the next page of data
#  Intermediary: for paging - hasNextPage, hasPreviousPage, endCursor, startCursor
#
#
#        output: The results as JSON
#
#       precond:
#      postcond:

query ($loginOrg: String!, $firstFew: Int, $startWith: String, $projectNum: Int!) {
 #   query ($first: Int!, $skip: Int!) {
 # products(first: $first, skip: $skip) {
    organization(login: $loginOrg) {
            id
            email
            projectsUrl
            login
            projectV2 (number: $projectNum) {
                id
                title
                closed
                number
                createdAt
                updatedAt
                closedAt
                url
                creator {
                    login
                }
                items (first: $firstFew, after: $startWith) {

                     totalCount
                     pageInfo {
                        hasNextPage
                        hasPreviousPage
                        endCursor
                        startCursor
                    }
                    nodes {
                        id
                        type
                        fieldValueByName (name: "Status") {
                            ... on ProjectV2ItemFieldDateValue {
                                date
                            }

                            ... on  ProjectV2ItemFieldIterationValue {
                                id
                            }
                            ... on  ProjectV2ItemFieldLabelValue {
                                labels {
                                    totalCount
                                    nodes {
                                        name
                                    }
                                }
                            }
                            ... on  ProjectV2ItemFieldMilestoneValue {
                                milestone {
                                    title
                                }
                            }
                            ... on  ProjectV2ItemFieldNumberValue {
                                number
                            }
                            ... on  ProjectV2ItemFieldPullRequestValue {
                                pullRequests {
                                    totalCount
                                }
                            }
                            ... on  ProjectV2ItemFieldRepositoryValue {
                                repository {
                                    name
                                    id

                                }
                            }
                            ... on  ProjectV2ItemFieldReviewerValue {
                                reviewers(first:1) {
                                    totalCount
                                }

                            }
                            ... on  ProjectV2ItemFieldSingleSelectValue {
                                name
                            }
                            ... on  ProjectV2ItemFieldTextValue {
                                text

                            }
                            ... on  ProjectV2ItemFieldUserValue {
                                users(first:20) {
                                    totalCount
                                }
                            }
                        }
                        content {
                            ... on Issue {
                                repository {
                                    name
                                }
                                title
                                number
                                url
                                closed
                                closedAt
                                labels (first: 10) {
                                  totalCount
                                    nodes {
                                        name
                                    }
                                }
                            }
                            ... on PullRequest {
                                repository {
                                    name
                                }
                                title
                                number
                                url
                                closed
                                closedAt
                                labels (first: 10) {
                                  totalCount
                                    nodes {
                                        name
                                    }
                                }
                                closingIssuesReferences (first: 20){
                                    totalCount
                                    nodes {
                                        number
                                        }

                                }
                            }
                            ... on DraftIssue {
                                title
                            }

                        }
                    }
                }
            }
        }
}
